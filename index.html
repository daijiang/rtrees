<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="To facilitate generating phylogenies from synthesis trees.">
<title>Deriving Phylogenies from Synthesis Trees • rtrees</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Deriving Phylogenies from Synthesis Trees">
<meta property="og:description" content="To facilitate generating phylogenies from synthesis trees.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">rtrees</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/Non-monophyletic-groups.html">Non-monophyletic genera</a>
    <a class="dropdown-item" href="articles/Simple_example.html">Simple_example</a>
    <a class="dropdown-item" href="articles/grafting_scenarios.html">Grafting Scenarios</a>
    <a class="dropdown-item" href="articles/speed.html">Speed comparisons</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="rtrees">rtrees<a class="anchor" aria-label="anchor" href="#rtrees"></a>
</h1></div>
<p>The goal of <code>rtrees</code> is to remove the barriers to derive phylogenies for a list of species from mega-trees. Basically, <code>Phylomatic</code> and more.</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  rtrees <span class="op">=</span> <span class="st">'https://daijiang.r-universe.dev'</span>,</span>
<span>  CRAN <span class="op">=</span> <span class="st">'https://cloud.r-project.org'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rtrees"</span><span class="op">)</span></span></code></pre></div>
<p>The above code will also install one dependency <a href="https://github.com/daijiang/megatrees" class="external-link">{megatrees}</a>, an R data package that hosts the megatrees used here.</p>
<div class="section level2">
<h2 id="shinny-app">Shinny app<a class="anchor" aria-label="anchor" href="#shinny-app"></a>
</h2>
<p>There is also a <a href="https://djli.shinyapps.io/rtrees_shiny/" class="external-link">Shinny app</a> to get phylogenies without using R. However, given that I can only afford the free plan, the number of species to be inserted to the megatrees here will be limited to 1,000.</p>
</div>
</div>
<div class="section level1">
<h1 id="mega-trees">Mega-trees<a class="anchor" aria-label="anchor" href="#mega-trees"></a>
</h1>
<p>Currently, <code>rtrees</code> provides mega-trees for the following taxonomic groups: amphibian, bird, fish, mammal, plant, reptile, and shark_ray. The mega-trees (or subset of 100 posterior phylogenies; 50 for fish to reduce the package size) are saved in the data package <a href="https://github.com/daijiang/megatrees" class="external-link">{megatrees}</a>.</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="14%">
<col width="12%">
<col width="28%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>Taxon</th>
<th># of species</th>
<th># of trees</th>
<th>R object (in <code>{megatrees}</code>)</th>
<th>Reference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Amphibian</td>
<td>7238</td>
<td>100</td>
<td><code>tree_amphibian_n100</code></td>
<td>Jetz and Pyron 2018</td>
</tr>
<tr class="even">
<td>Bird</td>
<td>9993</td>
<td>100</td>
<td><code>tree_bird_n100</code></td>
<td>Jetz et al. 2012</td>
</tr>
<tr class="odd">
<td>Fish</td>
<td>11638</td>
<td>1</td>
<td><code>tree_fish_12k</code></td>
<td>Rabosky et al. 2018</td>
</tr>
<tr class="even">
<td></td>
<td>31516</td>
<td>50</td>
<td><code>tree_fish_32k_n50</code></td>
<td>Rabosky et al. 2018</td>
</tr>
<tr class="odd">
<td>Mammal</td>
<td>5831</td>
<td>100</td>
<td><code>tree_mammal_n100_phylacine</code></td>
<td>Faurby et al. 2018</td>
</tr>
<tr class="even">
<td></td>
<td>5911</td>
<td>100</td>
<td><code>tree_mammal_n100_vertlife</code></td>
<td>Upham et al. 2019</td>
</tr>
<tr class="odd">
<td>Plant</td>
<td>74531</td>
<td>1</td>
<td><code>tree_plant_otl</code></td>
<td>Brown and Smith 2018</td>
</tr>
<tr class="even">
<td>Reptile (Squamate)</td>
<td>9755</td>
<td>100</td>
<td><code>tree_reptile_n100</code></td>
<td>Tonini et al. 2016</td>
</tr>
<tr class="odd">
<td>Shark, Ray, and Chimaera</td>
<td>1192</td>
<td>100</td>
<td><code>tree_shark_ray_n100</code></td>
<td>Stein et al. 2018</td>
</tr>
</tbody>
</table>
</div>
<div class="section level1">
<h1 id="usage-examples">Usage examples<a class="anchor" aria-label="anchor" href="#usage-examples"></a>
</h1>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://daijiang.github.io/rtrees/">rtrees</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="prepare-species-data-frame-optional">Prepare species data frame (optional)<a class="anchor" aria-label="anchor" href="#prepare-species-data-frame-optional"></a>
</h2>
<p>The species lists which we want to have a phylogeny should be provided as a data frame with at least 3 columns: <code>family</code>, <code>genus</code>, and <code>species</code>. Their order does not matter. Here is an example for fish.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_fish_list</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Serrasalmus_geryi"</span>, <span class="st">"Careproctus_reinhardti"</span>, <span class="st">"Gobiomorphus_coxii"</span>, </span>
<span>              <span class="st">"Periophthalmus_barbarus"</span>, <span class="st">"Prognichthys_glaphyrae"</span>, <span class="st">"Barathronus_bicolor"</span>, </span>
<span>              <span class="st">"Knipowitschia_croatica"</span>, <span class="st">"Rhamphochromis_lucius"</span>, <span class="st">"Neolissochilus_tweediei"</span>, </span>
<span>              <span class="st">"Haplochromis_nyanzae"</span>, <span class="st">"Astronesthes_micropogon"</span>, <span class="st">"Sanopus_reticulatus"</span><span class="op">)</span>,</span>
<span>  genus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Serrasalmus"</span>, <span class="st">"Careproctus"</span>, <span class="st">"Gobiomorphus"</span>, <span class="st">"Periophthalmus"</span>,</span>
<span>            <span class="st">"Prognichthys"</span>, <span class="st">"Barathronus"</span>, <span class="st">"Knipowitschia"</span>, <span class="st">"Rhamphochromis"</span>, </span>
<span>            <span class="st">"Neolissochilus"</span>, <span class="st">"Haplochromis"</span>, <span class="st">"Astronesthes"</span>, <span class="st">"Sanopus"</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Serrasalmidae"</span>, <span class="st">"Liparidae"</span>, <span class="st">"Eleotridae"</span>, <span class="st">"Gobiidae"</span>, </span>
<span>             <span class="st">"Exocoetidae"</span>, <span class="st">"Aphyonidae"</span>, <span class="st">"Gobiidae"</span>, <span class="st">"Cichlidae"</span>, </span>
<span>             <span class="st">"Cyprinidae"</span>, <span class="st">"Cichlidae"</span>, <span class="st">"Stomiidae"</span>, <span class="st">"Batrachoididae"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_fish_list</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 3</span></span>
<span><span class="co">#&gt;    species                 genus          family        </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                   &lt;chr&gt;          &lt;chr&gt;         </span></span>
<span><span class="co">#&gt;  1 Serrasalmus_geryi       Serrasalmus    Serrasalmidae </span></span>
<span><span class="co">#&gt;  2 Careproctus_reinhardti  Careproctus    Liparidae     </span></span>
<span><span class="co">#&gt;  3 Gobiomorphus_coxii      Gobiomorphus   Eleotridae    </span></span>
<span><span class="co">#&gt;  4 Periophthalmus_barbarus Periophthalmus Gobiidae      </span></span>
<span><span class="co">#&gt;  5 Prognichthys_glaphyrae  Prognichthys   Exocoetidae   </span></span>
<span><span class="co">#&gt;  6 Barathronus_bicolor     Barathronus    Aphyonidae    </span></span>
<span><span class="co">#&gt;  7 Knipowitschia_croatica  Knipowitschia  Gobiidae      </span></span>
<span><span class="co">#&gt;  8 Rhamphochromis_lucius   Rhamphochromis Cichlidae     </span></span>
<span><span class="co">#&gt;  9 Neolissochilus_tweediei Neolissochilus Cyprinidae    </span></span>
<span><span class="co">#&gt; 10 Haplochromis_nyanzae    Haplochromis   Cichlidae     </span></span>
<span><span class="co">#&gt; 11 Astronesthes_micropogon Astronesthes   Stomiidae     </span></span>
<span><span class="co">#&gt; 12 Sanopus_reticulatus     Sanopus        Batrachoididae</span></span></code></pre></div>
<p>For plant, fish, bird, and mammal, it is possible to prepare <code>sp_list</code> with function <code><a href="reference/sp_list_df.html">sp_list_df()</a></code>; though you should check the results. It is possible to just provide the speices as a character vector for these taxon groups (or all genus in your species list are presented in the phylogeny).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/sp_list_df.html">sp_list_df</a></span><span class="op">(</span>sp_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Periophthalmus_barbarus"</span>, <span class="st">"Barathronus_bicolor"</span><span class="op">)</span>,</span>
<span>           taxon <span class="op">=</span> <span class="st">"fish"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span><span class="co">#&gt;   species                 genus          family    </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                   &lt;chr&gt;          &lt;chr&gt;     </span></span>
<span><span class="co">#&gt; 1 Periophthalmus_barbarus Periophthalmus Gobiidae  </span></span>
<span><span class="co">#&gt; 2 Barathronus_bicolor     Barathronus    Aphyonidae</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-phylogeny-from-one-megatree">Get phylogeny from one megatree<a class="anchor" aria-label="anchor" href="#get-phylogeny-from-one-megatree"></a>
</h2>
<p>Once we have the species list ready, we can then derive a phylogeny from <code>tree_fish</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_tree</span> <span class="op">=</span> <span class="fu"><a href="reference/get_tree.html">get_tree</a></span><span class="op">(</span>sp_list <span class="op">=</span> <span class="va">test_fish_list</span>,</span>
<span>                     taxon <span class="op">=</span> <span class="st">"fish"</span>,</span>
<span>                     scenario <span class="op">=</span> <span class="st">"at_basal_node"</span>,</span>
<span>                     show_grafted <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 6 species added at genus level (*)</span></span>
<span><span class="co">#&gt; 1 species have no co-family species in the mega-tree, skipped</span></span>
<span><span class="co">#&gt; (if you know their family, prepare and edit species list with `rtrees::sp_list_df()` may help): </span></span>
<span><span class="co">#&gt; Barathronus_bicolor</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">test_tree</span>, no.margin <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="100%"></p>
<p>No matter whether <code>show_grafted</code> is ‘TRUE’ or ‘FALSE’, the grafting information was saved along with the phylogeny and can be extracted with the following code:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or use rtrees::get_graft_status(test_tree)</span></span>
<span><span class="va">test_tree</span><span class="op">$</span><span class="va">graft_status</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 3</span></span>
<span><span class="co">#&gt;    tip_label                species                 status                      </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                    &lt;chr&gt;                   &lt;chr&gt;                       </span></span>
<span><span class="co">#&gt;  1 Prognichthys_glaphyrae   Prognichthys_glaphyrae  exisiting species in the me…</span></span>
<span><span class="co">#&gt;  2 Rhamphochromis_lucius*   Rhamphochromis_lucius   grafted at genus level      </span></span>
<span><span class="co">#&gt;  3 Haplochromis_nyanzae*    Haplochromis_nyanzae    grafted at genus level      </span></span>
<span><span class="co">#&gt;  4 Knipowitschia_croatica*  Knipowitschia_croatica  grafted at genus level      </span></span>
<span><span class="co">#&gt;  5 Periophthalmus_barbarus  Periophthalmus_barbarus exisiting species in the me…</span></span>
<span><span class="co">#&gt;  6 Gobiomorphus_coxii       Gobiomorphus_coxii      exisiting species in the me…</span></span>
<span><span class="co">#&gt;  7 Careproctus_reinhardti   Careproctus_reinhardti  exisiting species in the me…</span></span>
<span><span class="co">#&gt;  8 Sanopus_reticulatus*     Sanopus_reticulatus     grafted at genus level      </span></span>
<span><span class="co">#&gt;  9 Astronesthes_micropogon* Astronesthes_micropogon grafted at genus level      </span></span>
<span><span class="co">#&gt; 10 Neolissochilus_tweediei* Neolissochilus_tweediei grafted at genus level      </span></span>
<span><span class="co">#&gt; 11 Serrasalmus_geryi        Serrasalmus_geryi       exisiting species in the me…</span></span>
<span><span class="co">#&gt; 12 &lt;NA&gt;                     Barathronus_bicolor     skipped as no co-family in …</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-a-set-of-phylogenies-from-multiple-posterior-megatrees">Get a set of phylogenies from multiple posterior megatrees<a class="anchor" aria-label="anchor" href="#get-a-set-of-phylogenies-from-multiple-posterior-megatrees"></a>
</h2>
<p>The function <code><a href="reference/get_tree.html">rtrees::get_tree()</a></code> can also work with a set of posterior megatrees with the option to use parallel computing for the whole process. The default number of cores to be used will be the available number of cores minus 2 (so that users can still perform other tasks on their computers at the same time). The output will be a set of generated phylogenies with class <code>multiPhylo</code>; the number of derived phylogenies will be the same as the input megatrees. For this scenario, we can use exactly the same code described above. For example, if we want to use the 100 randomly selected posterior phylogenies that have ~32k fish species, we can add the <code>fish_tree = "all-taxon</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_tree2</span> <span class="op">=</span> <span class="fu"><a href="reference/get_tree.html">get_tree</a></span><span class="op">(</span>sp_list <span class="op">=</span> <span class="va">test_fish_list</span>,</span>
<span>                     taxon <span class="op">=</span> <span class="st">"fish"</span>,</span>
<span>                     scenario <span class="op">=</span> <span class="st">"at_basal_node"</span>,</span>
<span>                     show_grafted <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     fish_tree <span class="op">=</span> <span class="st">"all-taxon"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Wow, all species are already in the mega-tree!</span></span>
<span><span class="va">test_tree2</span></span>
<span><span class="co">#&gt; 50 phylogenetic trees</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/ladderize.html" class="external-link">ladderize</a></span><span class="op">(</span><span class="va">test_tree2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, no.margin <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="add-tips-to-user-provided-trees">Add tips to user provided trees<a class="anchor" aria-label="anchor" href="#add-tips-to-user-provided-trees"></a>
</h2>
<p>It is also possible to derive a phylogeny based on a user provided tree. This can be particularly useful if we have things like <code>Acer_spp</code> that we want to insert to the basal node of the genus.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_tree</span> <span class="op">=</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"(((((((((Potentilla_intermedia:1.156097,Potentilla_gracilis:1.156097):9.169741,Potentilla_bipinnatifida:10.325839):10.466967,Potentilla_sterilis:20.792806):11.333216,Fragaria_virginiana:32.126022):6.026567,(((((Rosa_setigera:3.434279,Rosa_arkansana:3.434279):1.991106,Rosa_spinosissima:5.425386):0.993924,Rosa_acicularis:6.419309):6.730804,(Rosa_micrantha:0.188519,Rosa_canina:0.188519):12.961594):23.677485,(Agrimonia_gryposepala:4.730863,Agrimonia_parviflora:4.730863):32.096735):1.324992):6.47604,(Geum_urbanum:11.153303,Geum_rivale:11.153303):33.475326):1.449852,((((((((Rubus_semisetosus:3.10529,Rubus_glandicaulis:3.10529):0.957584,Rubus_steelei:4.062873):0.398394,Rubus_cuneifolius:4.461267):2.271628,Rubus_vagus:6.732895):0.023439,Rubus_superioris:6.756333):0.020104,(Rubus_multifer:4.287114,Rubus_elegantulus:4.287115):2.489323):0.025475,((Rubus_laciniatus:0.125186,Rubus_bifrons:0.125186):0.11903,Rubus_praecox:0.244216):6.557697):11.571849,(Rubus_parviflorus:14.85915,Rubus_odoratus:14.85915):3.514612):27.704718):16.915234,Filipendula_rubra:62.993714):13.354116,((((((((((Crataegus_dissona:0.081863,Crataegus_florifera:0.081863):0.49838,Crataegus_fulleriana:0.580243):1.434261,Crataegus_crus-galli:2.014503):0.177737,Crataegus_chrysocarpa:2.192239):0.051159,Crataegus_uniflora:2.243399):0.438351,Crataegus_persimilis:2.68175):4.697259,((Malus_toringo:6.472694,Malus_ioensis:6.472693):0.772012,Chaenomeles_speciosa:7.244705):0.134305):1.72489,Pyrus_communis:9.1039):0.313393,Amelanchier_spicata:9.417293):40.039557,((((((Prunus_pumila:6.189944,Prunus_nigra:6.189945):0.37487,Prunus_pensylvanica:6.564815):4.856241,(Prunus_padus:4.816999,Prunus_serotina:4.817):6.604057):29.162527,Sorbaria_sorbifolia:40.583584):2.924475,Rhodotypos_scandens:43.50806):2.718224,(Spiraea_X_bumalda:25.921582,Aruncus_dioicus:25.921583):20.304701):3.230567):26.89098);"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_tree_sp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Rosa_sp"</span>, <span class="st">"Rubus_sp"</span>, <span class="st">"Amelanchier_sp"</span>, <span class="st">"Prunus_sp"</span>, <span class="st">"Sorbus_sp"</span>, <span class="st">"Potentilla_sp"</span>,</span>
<span>  <span class="st">"Potentilla_intermedia"</span>, <span class="st">"Potentilla_gracilis"</span>, <span class="st">"Potentilla_bipinnatifida"</span>, <span class="st">"Potentilla_sterilis"</span>, <span class="st">"Fragaria_virginiana"</span>, <span class="st">"Rosa_setigera"</span>, <span class="st">"Rosa_arkansana"</span>, <span class="st">"Rosa_spinosissima"</span>, <span class="st">"Rosa_acicularis"</span>, <span class="st">"Rosa_micrantha"</span>, <span class="st">"Rosa_canina"</span>, <span class="st">"Agrimonia_gryposepala"</span>, <span class="st">"Agrimonia_parviflora"</span>, <span class="st">"Geum_urbanum"</span>, <span class="st">"Geum_rivale"</span>, <span class="st">"Rubus_semisetosus"</span>, <span class="st">"Rubus_glandicaulis"</span>, <span class="st">"Rubus_steelei"</span>, <span class="st">"Rubus_cuneifolius"</span>, <span class="st">"Rubus_vagus"</span>, <span class="st">"Rubus_superioris"</span>, <span class="st">"Rubus_multifer"</span>, <span class="st">"Rubus_elegantulus"</span>, <span class="st">"Rubus_laciniatus"</span>, <span class="st">"Rubus_bifrons"</span>, <span class="st">"Rubus_praecox"</span>, <span class="st">"Rubus_parviflorus"</span>, <span class="st">"Rubus_odoratus"</span>, <span class="st">"Filipendula_rubra"</span>, <span class="st">"Crataegus_dissona"</span>, <span class="st">"Crataegus_florifera"</span>, <span class="st">"Crataegus_fulleriana"</span>, <span class="st">"Crataegus_crus-galli"</span>, <span class="st">"Crataegus_chrysocarpa"</span>, <span class="st">"Crataegus_uniflora"</span>, <span class="st">"Crataegus_persimilis"</span>, <span class="st">"Malus_toringo"</span>, <span class="st">"Malus_ioensis"</span>, <span class="st">"Chaenomeles_speciosa"</span>, <span class="st">"Pyrus_communis"</span>, <span class="st">"Amelanchier_spicata"</span>, <span class="st">"Prunus_pumila"</span>, <span class="st">"Prunus_nigra"</span>, <span class="st">"Prunus_pensylvanica"</span>, <span class="st">"Prunus_padus"</span>, <span class="st">"Prunus_serotina"</span>, <span class="st">"Sorbaria_sorbifolia"</span>, <span class="st">"Rhodotypos_scandens"</span>, <span class="st">"Spiraea_X_bumalda"</span>, <span class="st">"Aruncus_dioicus"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="reference/get_tree.html">get_tree</a></span><span class="op">(</span>sp_list <span class="op">=</span> <span class="va">test_tree_sp</span>, tree <span class="op">=</span> <span class="va">test_tree</span>, taxon <span class="op">=</span> <span class="st">"plant"</span>,</span>
<span>              show_grafted <span class="op">=</span> <span class="cn">T</span>, tree_by_user <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"fan"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Not all genus can be found in the phylogeny.</span></span>
<span><span class="co">#&gt; Warning: For user provided phylogeny, without a classification for all genus of species in the phylogeny,</span></span>
<span><span class="co">#&gt;               it is unlikely to find the most recent ancestor for genus and family; here we proceed the phylogeny</span></span>
<span><span class="co">#&gt;               by adding root information for genus and family that can be found in the phylogeny or species list but</span></span>
<span><span class="co">#&gt;               we recommend to prepare the phylogeny using `add_root_info()` with a classification</span></span>
<span><span class="co">#&gt;               data frame with all tips first.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 5 species added at genus level (*)</span></span>
<span><span class="co">#&gt; 1 species added at family level (**)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png" width="100%"></p>
<p><strong>Pay attention to the warning message there</strong>. Because not all genera in the species list are presented in the megatree, it is impossible to find the most recent ancestor for genus and family that are missing from the megatree. Therefore, <strong>for user-provided phylogenies, here is the recommended steps</strong>:</p>
<ol style="list-style-type: decimal">
<li>Get the classification information (a data frame with two columns: genus and family) for all genera presented in the species list and the megatree.</li>
<li>Prepare the species list as a data frame with three columns: species, genus, and family using the classification information.</li>
<li>Process the megatree using function <code>processed_tree = rtrees::add_root_infor(tree, classification)</code>.</li>
<li>Pass the processed megatree to <code>rtrees::get_tree(sp_list_data_frame, processed_tree)</code> to derive the phylogeny for your species list.</li>
</ol>
</div>
<div class="section level2">
<h2 id="bind-missing-species-to-specified-places">Bind missing species to specified places<a class="anchor" aria-label="anchor" href="#bind-missing-species-to-specified-places"></a>
</h2>
<p>It is also possible to specify a particular species to bind with by specifying columns <code>close_sp</code> and/or <code>close_genus</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_tree_sp_df</span> <span class="op">=</span> <span class="fu"><a href="reference/sp_list_df.html">sp_list_df</a></span><span class="op">(</span><span class="va">test_tree_sp</span>, <span class="st">"plant"</span><span class="op">)</span></span>
<span><span class="va">test_tree_sp_df</span><span class="op">$</span><span class="va">close_sp</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="va">test_tree_sp_df</span><span class="op">$</span><span class="va">close_sp</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Rosa_acicularis"</span> <span class="co"># bind Rosa_sp to here</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="reference/get_tree.html">get_tree</a></span><span class="op">(</span>sp_list <span class="op">=</span> <span class="va">test_tree_sp_df</span>, tree <span class="op">=</span> <span class="va">test_tree</span>, taxon <span class="op">=</span> <span class="st">"plant"</span>,</span>
<span>              show_grafted <span class="op">=</span> <span class="cn">T</span>, tree_by_user <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"fan"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Not all genus can be found in the phylogeny.</span></span>
<span><span class="co">#&gt; Warning: For user provided phylogeny, without a classification for all genus of species in the phylogeny,</span></span>
<span><span class="co">#&gt;               it is unlikely to find the most recent ancestor for genus and family; here we proceed the phylogeny</span></span>
<span><span class="co">#&gt;               by adding root information for genus and family that can be found in the phylogeny or species list but</span></span>
<span><span class="co">#&gt;               we recommend to prepare the phylogeny using `add_root_info()` with a classification</span></span>
<span><span class="co">#&gt;               data frame with all tips first.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 5 species added at genus level (*)</span></span>
<span><span class="co">#&gt; 1 species added at family level (**)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="100%"></p>
</div>
</div>
<div class="section level1">
<h1 id="some-notes">Some notes<a class="anchor" aria-label="anchor" href="#some-notes"></a>
</h1>
<ul>
<li>If <code>tree</code> is specified, then <code>taxon</code> can be ignored if all genus in the species list are presented in the phylogeny.</li>
<li>If a species does not have a co-family species in the mega-tree, it will be skipped.</li>
<li>If <code>show_grafted = TRUE</code>, species that are grafted will have one or two <code>*</code> at the end of their names.
<ul>
<li>If it is grafted at the genus level, one <code>*</code>.</li>
<li>If it is grafted at the family level, two <code>*</code>s (i.e., <code>**</code>).</li>
</ul>
</li>
<li>The default scenario is <code>at_basal_node</code>, which will graft species at the genus/family basal node.
<ul>
<li>
<code>random_below_basal</code> will randomly select a downstream node to attach the new tip.</li>
<li>If only one species in the mega-tree that is in the same genus/family of the new tip, then the new tip will be grafted at the middle of this species’ branch for all scenarios.</li>
</ul>
</li>
<li>The <code>tree</code> can be a user provided tree, if so, set <code>tree_by_user = TRUE</code>.</li>
<li>See <code><a href="reference/get_tree.html">?get_tree</a></code> for more details.</li>
</ul>
</div>
<div class="section level1">
<h1 id="contribution">Contribution<a class="anchor" aria-label="anchor" href="#contribution"></a>
</h1>
<p>Feel free to test it. Contributions and suggestions are welcome. You can open an issue or send a pull request.</p>
</div>
<div class="section level1">
<h1 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h1>
<p>Li Daijiang. (2023). rtrees: an R package to assemble phylogenetic trees from megatrees. Ecography.</p>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing rtrees</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Daijiang Li <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-0925-3421" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Daijiang Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
