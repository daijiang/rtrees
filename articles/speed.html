<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Speed comparisons • rtrees</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Speed comparisons">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtrees</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/grafting_scenarios.html">Grafting Scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/Non-monophyletic-groups.html">Non-monophyletic genera</a></li>
    <li><a class="dropdown-item" href="../articles/Simple_example.html">Simple_example</a></li>
    <li><a class="dropdown-item" href="../articles/speed.html">Speed comparisons</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Speed comparisons</h1>
            
      

      <div class="d-none name"><code>speed.Rmd</code></div>
    </div>

    
    
<p>Here, I compared the performance of <code>rtrees</code> (v1.0.0) and
<code>V.PhyloMaker</code> (v0.1.0) (<code>V.PhyloMaker2</code> has
almost the same speed as <code>V.PhyloMaker</code>, so no comparisons
here). In most cases, <code>rtrees</code> is at least two times faster
than <code>V.PhyloMaker</code> (Fig. below). For example, with 50
missing species to bind, the average time used by <code>rtrees</code> is
0.914 second while <code>V.PhyloMaker</code> took 13.6 seconds on
average; with 5,000 missing species to bind, <code>rtrees</code> used
80.9 seconds on average while <code>V.PhyloMaker</code> used 187
seconds. In general, the time used by <code>rtrees</code> and
<code>V.PhyloMaker</code> increased 15.6 and 34.8 seconds on average
with 1,000 more missing species to be grafted, respectively. All tests
were conducted on a 14’ Macbook Pro with M1 pro chip.</p>
<p>Some may not think it is a big difference. However, for me as a user,
waiting for more than 10 seconds to have about 50 species grafted is not
ideal. Also the accumulated time can be large if one is doing this
multiple times (e.g., doing some simulations that require thousands of
iterations).</p>
<p>The R code used for the speed tests can be found <a href="https://github.com/daijiang/rtrees_ms/blob/main/Rcode/speed_test.R" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># library(broom)</span></span>
<span><span class="va">temf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/daijiang/rtrees_ms/main/Data/rtrees_speed_out.rds"</span>, </span>
<span>              destfile <span class="op">=</span> <span class="va">temf</span><span class="op">)</span></span>
<span><span class="va">speed_out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">temf</span><span class="op">)</span></span>
<span><span class="va">speed_out</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">speed_out</span>, n_sp_missing_k <span class="op">=</span> <span class="va">n_sp_missing</span> <span class="op">/</span> <span class="fl">1000</span>, time_s <span class="op">=</span> <span class="va">time</span><span class="op">/</span><span class="fl">1e9</span><span class="op">)</span></span>
<span><span class="co"># speed_lm = dplyr::group_by(speed_out, expr) |&gt; </span></span>
<span><span class="co">#   dplyr::do(broom::tidy(lm(time_s ~ n_sp_missing_k, data = .))) |&gt; </span></span>
<span><span class="co">#   dplyr::ungroup()</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">speed_out</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_sp_missing_k</span>, y <span class="op">=</span> <span class="va">time_s</span>, color <span class="op">=</span> <span class="va">expr</span>, group <span class="op">=</span> <span class="va">expr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of binding species (Thousand)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Time (Second)"</span>, color <span class="op">=</span> <span class="cn">NULL</span>, group <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">200</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">4</span>, y <span class="op">=</span> <span class="fl">33</span>, label <span class="op">=</span> <span class="st">"rtrees: y = -0.09 + 15.6x"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"#F8766D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.8</span>, y <span class="op">=</span> <span class="fl">123</span>, label <span class="op">=</span> <span class="st">"V.PhyloMaker: y = 11.80 + 34.8x"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"#00BFC4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p><img src="speed_files/figure-html/unnamed-chunk-2-1.png" width="90%"></p>
<p>Based on the figure above, the time used by <code>rtrees</code> (and
other R packages such as <code>V.PhyloMaker</code> and
<code>FishPhyloMaker</code>) increased linearly with the number of
missing species. This is because of the sequential structure of the R
<code>phylo</code> object, in which all tips and nodes of a phylogeny
are labeled with continued integers. When a new node or tip needs to be
inserted, all the numbers after the binding location need to be pushed
one place after. Therefore, the binding of tips in an R
<code>phylo</code> object is a sequential process, which cannot be
conducted with parallel computing to take advantage of the multiple CPU
cores a regular computer has nowadays. It is possible to speed it up by
converting some core R code into C++. However, it takes a lot of effort
to do this right.</p>
<p>Another potential resolution is to represent phylogenies in a
non-sequential structure unlike <code>phylo</code> objects in R. One
example is the <a href="https://github.com/DomBennett/treeman" class="external-link"><code>treeman</code>
package</a>, which developed such a structure to perform tree
manipulations. Because of the non-sequential structure (i.e., no
continuous labeling of nodes and tips), it is possible to use parallel
computing to process phylogenies. However, such a structure has not yet
been adapted widely by the R community. Therefore, the infrastructure to
support such a non-sequential structure in R is still missing, making it
hard to use it here in <code>rtrees</code>.</p>
<p>Despite the limitations described above, <code>rtrees</code> is
reasonably fast and user-friendly with informative messages.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daijiang Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
